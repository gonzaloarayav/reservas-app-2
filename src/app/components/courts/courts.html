<div class="courts-container">
  <div class="courts-header">
    <h1>Canchas Disponibles</h1>
    <p>Encuentra y reserva la cancha perfecta para tu deporte favorito</p>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-form">
      <mat-form-field appearance="outline">
        <mat-label>Buscar canchas</mat-label>
        <input
          matInput
          [(ngModel)]="searchQuery"
          placeholder="Nombre o ubicaci칩n"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Tipo de cancha</mat-label>
        <mat-select [(ngModel)]="selectedType">
          <mat-option value="">Todos los tipos</mat-option>
          @for(type of courtTypes; track type){
          <mat-option [value]="type">{{ type }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="applyFilters()">
          <mat-icon>filter_list</mat-icon> Aplicar Filtros
        </button>
        <button mat-button (click)="resetFilters()">
          <mat-icon>clear</mat-icon> Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Courts List -->
  <div class="courts-grid">
    @for(court of filteredCourts$ | async; track court){
    <mat-card class="court-card">
      <div class="court-image-container">
        <img
          mat-card-image
          [src]="court.imageUrl"
          alt="{{ court.name }}"
          class="court-image"
          (error)="onImageError($event)"
        />
        <div class="court-image-fallback" style="display: none;">
          <mat-icon>sports_tennis</mat-icon>
          <span>{{ court.type | titlecase }}</span>
        </div>
      </div>
      <mat-card-content>
        <h2 class="court-name">{{ court.name }}</h2>
        <p class="court-type">{{ court.type | titlecase }}</p>
        <p class="court-location">
          <mat-icon>location_on</mat-icon> {{ court.location }}
        </p>
        <p class="court-price">
          <mat-icon>attach_money</mat-icon> ${{ court.pricePerHour }} / hora
        </p>

        @if(court.features && court.features.length > 0){
        <div class="court-features">
          @for(feature of court.features; track feature){
          <span class="feature-tag">{{ feature }}</span>

          }
        </div>
        }
      </mat-card-content>
      <mat-card-actions>
        <a mat-button color="primary" [routerLink]="['/courts', court.id]">
          <mat-icon>visibility</mat-icon> Ver Detalles
        </a>
        
        <!-- Bot칩n de reserva para usuarios logueados -->
        <a
          *ngIf="isLoggedIn()"
          mat-raised-button
          color="accent"
          [routerLink]="['/reserve', court.id]"
        >
          <mat-icon>event_available</mat-icon> Reservar
        </a>
        
        <!-- Mensaje para usuarios no logueados -->
        <a
          *ngIf="!isLoggedIn()"
          mat-raised-button
          color="primary"
          routerLink="/login"
        >
          <mat-icon>login</mat-icon> Iniciar Sesi칩n para Reservar
        </a>
      </mat-card-actions>
    </mat-card>
    }
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="(filteredCourts$ | async)?.length === 0">
    <mat-icon>sports_tennis</mat-icon>
    <h3>No se encontraron canchas</h3>
    <p>Intenta con otros filtros o vuelve m치s tarde</p>
    <button mat-raised-button color="primary" (click)="resetFilters()">
      Ver todas las canchas
    </button>
  </div>
</div>
