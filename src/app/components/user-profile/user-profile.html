<div class="profile-container">
  <!-- Not logged in state -->
  <div class="not-logged-in" *ngIf="!isLoggedIn">
    <mat-icon>account_circle</mat-icon>
    <h2>Inicia sesión para ver tu perfil</h2>
    <p>Necesitas iniciar sesión para ver y editar tu información de perfil.</p>
    <a mat-raised-button color="primary" routerLink="/login">
      Iniciar Sesión
    </a>
  </div>

  <!-- User Profile Content -->
  @if(isLoggedIn && user){
  <div class="profile-content">
    <div class="profile-header">
      <h1>Mi Perfil</h1>
      <div class="profile-actions" *ngIf="!isEditing">
        <button mat-raised-button color="primary" (click)="startEditing()">
          <mat-icon>edit</mat-icon> Editar Perfil
        </button>
        <button mat-button color="warn" (click)="logout()">
          <mat-icon>exit_to_app</mat-icon> Cerrar Sesión
        </button>
      </div>
      <div class="profile-actions" *ngIf="isEditing">
        <button mat-raised-button color="primary" (click)="saveProfile()">
          <mat-icon>save</mat-icon> Guardar
        </button>
        <button mat-button (click)="cancelEditing()">
          <mat-icon>cancel</mat-icon> Cancelar
        </button>
      </div>
    </div>

    <div class="profile-card-container">
      <!-- Profile Info Card -->
      <mat-card class="profile-card">
        <div class="profile-image-container">
          <img
            [src]="user.profileImageUrl"
            alt="Foto de perfil"
            class="profile-image"
            (error)="onImageError($event)"
          />
          <div class="profile-image-fallback" style="display: none;">
            <mat-icon>account_circle</mat-icon>
            <span>{{ user.name | slice:0:2 | uppercase }}</span>
          </div>
          <div class="profile-image-overlay" *ngIf="isEditing">
            <mat-icon>photo_camera</mat-icon>
            <span>Cambiar foto</span>
          </div>
        </div>

        <mat-card-content>
          <!-- View Mode -->
          <div class="profile-details" *ngIf="!isEditing">
            <div class="detail-item">
              <mat-icon>person</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Nombre</span>
                <span class="detail-value">{{ user.name }}</span>
              </div>
            </div>

            <div class="detail-item">
              <mat-icon>email</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Email</span>
                <span class="detail-value">{{ user.email }}</span>
              </div>
            </div>

            <div class="detail-item">
              <mat-icon>phone</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Teléfono</span>
                <span class="detail-value"
                  >{{ user.phone || 'No especificado' }}</span
                >
              </div>
            </div>

            <div class="detail-item">
              <mat-icon>event</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Reservas</span>
                <span class="detail-value"
                  >{{ reservationsCount }} reservas realizadas</span
                >
              </div>
            </div>

            <div class="detail-item">
              <mat-icon>calendar_today</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Miembro desde</span>
                <span class="detail-value"
                  >{{ user.createdAt | date:'longDate':'':'es' }}</span
                >
              </div>
            </div>
          </div>

          <!-- Edit Mode -->
          <div class="profile-form" *ngIf="isEditing">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nombre</mat-label>
              <input
                matInput
                [(ngModel)]="editedUser.name"
                placeholder="Tu nombre"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Email</mat-label>
              <input
                matInput
                [(ngModel)]="editedUser.email"
                placeholder="Tu email"
                type="email"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Teléfono</mat-label>
              <input
                matInput
                [(ngModel)]="editedUser.phone"
                placeholder="Tu teléfono"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Contraseña</mat-label>
              <input
                matInput
                [(ngModel)]="editedUser.password"
                placeholder="Nueva contraseña"
                type="password"
              />
              <mat-hint
                >Deja en blanco para mantener la contraseña actual</mat-hint
              >
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Quick Links Card -->
      <mat-card class="quick-links-card">
        <mat-card-header>
          <mat-card-title>Acciones Rápidas</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <div class="quick-links">
            <a mat-button color="primary" routerLink="/reservations">
              <mat-icon>event</mat-icon> Mis Reservas
            </a>

            <a mat-button color="primary" routerLink="/reservations/new">
              <mat-icon>add</mat-icon> Nueva Reserva
            </a>

            <a mat-button color="primary" routerLink="/courts">
              <mat-icon>sports_tennis</mat-icon> Ver Canchas
            </a>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  }
</div>
